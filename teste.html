<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input type="text" class="autocomp" placeholder="sua faixa etária" list="faixa">
    <datalist id="faixa">
        <option value="">faixa etária:</option>
        <option value="oi tudo bem">menor de idade</option>
        <option value="+oi tudo mal">maior de idade</option>
        <option value="blabla">idoso</option>
    </datalist>

    <script>
        function cosineSimilarity(text1, text2) {
            // Pré-processamento: converter para minúsculas e dividir em palavras
            const words1 = text1.toLowerCase().split(/\s+/);
            const words2 = text2.toLowerCase().split(/\s+/);

            // Criar um conjunto de todas as palavras únicas
            const allWords = [...new Set([...words1, ...words2])];

            // Criar vetores de frequência
            const vector1 = allWords.map(word => words1.filter(w => w === word).length);
            const vector2 = allWords.map(word => words2.filter(w => w === word).length);

            // Calcular o produto escalar
            let dotProduct = 0;
            for (let i = 0; i < allWords.length; i++) {
                dotProduct += vector1[i] * vector2[i];
            }

            // Calcular as magnitudes
            const magnitude1 = Math.sqrt(vector1.reduce((sum, val) => sum + val * val, 0));
            const magnitude2 = Math.sqrt(vector2.reduce((sum, val) => sum + val * val, 0));

            // Calcular a similaridade de cossenos
            if (magnitude1 === 0 || magnitude2 === 0) {
                return 0;
            }

            return dotProduct / (magnitude1 * magnitude2);
        }

        function autoCompleteInput(classInput) {
            const autoInput = document.querySelectorAll(`.${classInput}`);

            autoInput.forEach(input => {
                input.addEventListener('change', function () {
                    const val = this.value;
                    const dataList = this.getAttribute('list');
                    const list = document.getElementById(dataList);
                    let options = list && list.querySelectorAll('option');
                    let similarities = [];
                    let maiorSimilaridade = 0;
                    let valor = "";
                    options.forEach(option => {
                        similarities.push({
                            value: option.value,
                            similarity: cosineSimilarity(val, option.value)
                        });
                    });

                    similarities.forEach(item => {
                        if (item.similarity > maiorSimilaridade) {
                            valor = item.value;
                            maiorSimilaridade = item.similarity;
                        }
                    });

                    if (maiorSimilaridade < 0.1) {
                        valor = "";
                    }

                    console.log(similarities);
                    
                    this.value = valor;
                    
                });
            });
        }

        autoCompleteInput('autocomp');
    </script>
</body>

</html>